export { future as theme } from "@mdx-deck/themes"
import SocialFollow from "./components/Social"
import CenteredImage from "./components/CenteredImage"
import { Appear, Notes  } from "mdx-deck";
import { CodeSurferLayout } from "code-surfer";
import {} from "code-surfer"
const chalk = require('chalk');


## Create your own "create-react-app"

#### by: Mauricio Mercado

<Notes>
Important grasp the knowledge!
Who has use CRA before?
Who has ejected an application?
Who has built a CLI with node before?
</Notes>

---

### $(whoami)

  - Working For Telus Digital
  - Lots of JS (React, NodeJS)
  - Creator of üêûsince 2010
  - Originally from üá®üá¥


<Notes>
Hello all,
My name, blah blah, I've been creating bugs since 2010, probably sooner as a sysadmin
being professionally developing stuff since 2010, started with python/django RoR
and eventually found NodeJS then react.
Working at Telus Digital for a the team responsible of creating the tools for
developer experience and evaluating the technologies used at telus.
</Notes>

---

## What this talk is about

<div>
  <ul>
    <Appear>
      <li>High overview of create react app components</li>
      <li><b><i>Building your own!</i></b></li>
    </Appear>
  </ul>
</div>

<Notes>
  We are going to be talking about CRA.
  The non-magic inside of create-react-app after all you can create your own.
</Notes>


---

## What is not about

The nitty gritty details of each component of CRA

<Notes>
  We are not going to discuss the specifics about babel, or webpack,
  nor about performance gains/losses, we are simply focusing on the
  cli that we are building
</Notes>

---

# LET'S DO THIS

![let's do this](https://i.imgflip.com/14p2is.jpg)

---

# What composes CRA?

<div>
  <ul>
    <Appear>
      <li>Babel (Transpilation)</li>
      <li>Webpack (HMR)</li>
      <li>Linter</li>
      <li>Tests Configured</li>
      <li>react-scripts</li>
    </Appear>
  </ul>
</div>


<Notes>
  Babel - transpiles ES6 unsupported by browser to syntax the browser understands
  ES2015+ dynamic imports, spread objects, classes async/await, typescript|flow

  Webpack - minimifies, uglifies, tree shaking, bundling

  Linters style-guides and avoid errors

  Jest already out of the box

  React-scripts (holds the app structure template and also a lot of configurations

  This tools makes our life so easy in order to start a react app
  because it does many choices for us as devs (javascript fatigue,
  and analysis paralysis).
</Notes>


---


# Why create your own generator CLI?

<CenteredImage height={230} width={405} src={require("file-loader!./images/angtft.gif")} />

<Notes>
  Customization to make developers life easy!

  We do a lot of that at Telus.

  What would happen if one of the packages has a vulnerability?

  What if you want to go the extra mile and stop bundling your project with what
  you don't need.

  Eventually we come up with a standard boilerplate if we are using redux, or
  the context api or any other lib that we add to our Created react app, and
  copy and paste a lot of stuff... and keep in mind that a good developer is a
  lazy developer -> we automate all the stuff that we can.
</Notes>


---

# Why create your own generator CLI?

## Why not?

<Notes>
  And in all honesty. because WHY NOT!

  You get to learn a ton about the underlying technology!

  Babel is not only for CRA, it's also used in the CLI I built

  Webpack is actually pretty cool, and if you want to optimize the size
  of your build, well what better tool than webpack itself.

  Streamline your work?

  Lighten the amount of packages your custom built depends on.

  Don't like CRA rules by default and always copy paste your own, build your own
  CRA (ok this might be an overkill reason but you get the idea üòè )

</Notes>

---

# Time for a DEMO

<CenteredImage
  height={230}
  width={405}
  src={require("file-loader!./images/Igtft.gif")}
/>

<Notes>
  do npx self-react-app
  explore files
</Notes>

---


# Let's see some code


---

<CodeSurferLayout>

```js title=""

const program = new commander.Command(packageJson.name)
  .version(packageJson.version)
  .arguments('<project directory>')
  .usage(`${chalk.green('<project-directory>')} [options]`)
  .action((name) => {
    projectName = name;
  })
  .allowUnknownOption()
  .on('--help', () => {
    log(`    Only ${chalk.green('<project-directory>')} is required.`);
    log();
  })
  .parse(process.argv);


```

</CodeSurferLayout>

---

<CodeSurferLayout>

```js

createApp(projectName);

```

```js 1:11

const createApp = (name) => {
  // Project root directory
  const root = path.resolve(name);

  checkAppName(name);
  fs.ensureDirSync(name);

  log(`Creating a new React app in ${chalk.green(root)}.`);
  log();
  executeCreation(root, name);
};

createApp(projectName);

```

```js 10

const createApp = (name) => {
  // Project root directory
  const root = path.resolve(name);

  checkAppName(name);
  fs.ensureDirSync(name);

  log(`Creating a new React app in ${chalk.green(root)}.`);
  log();
  executeCreation(root, name);
};

createApp(projectName);

```

</CodeSurferLayout>

---

<CodeSurferLayout>

```js 11:18

const executeCreation = async (root, appName) => {
  const spinner = new Ora({
    text: "Initializing project with npm init",
    spinner: "boxBounce2",
  });

  try {
    const deps = getProperDeps(originalPackageJSON.dependencies);
    const devDeps = getProperDeps(originalPackageJSON.devDependencies);

    await createValidPackageJson(appName, spinner);
    await addPackagesAndConfigToPackageJson(root, spinner);

    await npmInstallPackages(root, deps, true, spinner);
    await npmInstallPackages(root, devDeps, false, spinner);

    await setupRepo(root, spinner);
    await copyReactTemplateApp(root, appName, spinner);
    log(
      boxen("Your react application " + appName + "is ready to go!\n" +
          "To start coding the app run: cd " + appName + "\n" +
          "To start executing the application run: npm run start\n" +
          "To start executing the application tests run: npm run test"
        ,
        { padding: 1, borderStyle: 'doubleSingle', align: 'center' }),
    );
  } catch (err) {
    execSync("rm -rf " + appName);
    process.exit(1);
  }
};

```
</CodeSurferLayout>

---

<CodeSurferLayout>

```js

const createValidPackageJson = async (appName, spinner) => {
  spinner.start('Initializing package with npm');
  await execAsync("cd "+ appName " && npm init -y");
  spinner.succeed('npm init ran successfully');
};
```

</CodeSurferLayout>

---

<CodeSurferLayout>

```js

const addPackagesAndConfigToPackageJson = async (root, spinner) => {
  spinner.start('Adding configuration to npm package');
  const packageLocation = "root" + "/package.json";
  const packageJSON = await fs.readJSON(packageLocation);
  const newPackageJSON = { ...packageJSON, scripts };
  await fs.writeJSON(packageLocation, newPackageJSON, { spaces: 2 });
  spinner.succeed('npm package configured');
  return Promise.resolve();
};

```

</CodeSurferLayout>

---

<CodeSurferLayout>

```js

const npmInstallPackages = async (root, deps, isDeps, spinner) => {
  spinner.info("Initializing installation of " + isDeps ? "dependencies" : "devDependencies");
  log();
  const args = ['install', isDeps ? '--save' : '--save-dev'].concat(deps);

  const msg = isDeps ? 'dependencies installed' : 'devDependencies installed';
  const proc = spawnSync('npm', args, { stdio: 'inherit', cwd: root });

  if (proc.status !== 0) {
    throw new Error(proc.error);
  }
  spinner.succeed(msg);
};

```


</CodeSurferLayout>

---

<CodeSurferLayout>

```js

const setupRepo = async (root, spinner) => {
  spinner.start('Copying configuration files for react');
  const filesToCopy = [
    'README.md',
    'webpack.config.js',
    '.eslintrc.js',
    '.babelrc',
    'gitignore',
    'jest.config.js',
    '.stylelintrc'
  ];

  const promises = filesToCopy.map((file) => {
    let dst = root + "/" + file;
    if (file === 'gitignore') {
      dst = root + "/." file
    }
    return fs.copy(path.join(__dirname, "../templates/" + file), dst);
  });
  await Promise.all(promises);
  spinner.succeed('Configuration files copied');
};

```


</CodeSurferLayout>

---

<CodeSurferLayout>

```js

const copyReactTemplateApp = async (root, appName, spinner) => {
  spinner.start('Copying React application files');
  await fs.copy(path.join(__dirname, "../templates/src"), appName+ "src");
  spinner.succeed('React codebase ready to go!');
};

```

</CodeSurferLayout>


---

A simplified **_ejected_** version of CRA
##### (but that's just the beginning)

SRA ~1700 packages installed

CRA ~30000 packages installed


<Notes>
  Show generated react app

  why does SRA have so many config files? how to hide them? react-scripts!

  Show repo https://github.com/maumercado

  All things in javascript are object,
  even configuration files, so a lot of configuration files are
  actually contained/controlled by react-scripts, which hides them
  to the user but allows the project to use all those configurations
</Notes>

---

# Creating the CLI

<div>
  <ul>
    <Appear>
      <li>Commanded for parsing args</li>
      <li>Ora gives me the spinners</li>
      <li>Boxen and Chalk adds a bit more ‚ú®</li>
    </Appear>
  </ul>
</div>


---

# Bundled tools

<div>
  <ul>
    <Appear>
      <li>Webpack 4</li>
      <li>Reach/Router</li>
      <li>Jest</li>
      <li>Babel</li>
      <li>stylinter, eslint</li>
      <li>... and other requirements for a react app.</li>
    </Appear>
  </ul>
</div>


---

# Publishing

<div>
  <ul>
    <Appear>
      <li>Commitizen</li>
      <li>Semantic Release</li>
      <li>Travis CI</li>
      <li>Add compatibility by using Babel</li>
    </Appear>
  </ul>
</div>

---

# TODOs:

- ... Yeah yeah.. tests üòÖ
- Cross platform support (cross-env, rimraf, cross-spawn)
- Typescript support
- Update dependencies
- Add webpack bundle profiler
- Clearer README


---

# What's next?

<div>
  <ul>
    <li>Generate application files via CLI</li>
    <li>Generate your own server</li>
    <li>Generate your project files 'A la RoR'</li>
    <li>extendable self-scripts style</li>
    <Appear>
      <li>... Whatever you can imagine, it's your generator</li>
    </Appear>
  </ul>
</div>

---

# Thank you

Repo code:

  https://github.com/maumercado/self_react_app_cli

#### maumercado <SocialFollow />
###### _**Coming soon: maumercado.com**_
